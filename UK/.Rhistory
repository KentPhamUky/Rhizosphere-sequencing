ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot")
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
facet_wrap(.~Year) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot")
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
facet_wrap(Year~) +
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
facet_wrap(Year~) +
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
facet_wrap(Year~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot")
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
facet_wrap(~Year) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot")
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
scale_x_discrete(expand = 1) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
scale_x_discrete(expand = c(0.2, 0)) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
scale_x_discrete(expand = c(0.5, 0)) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
scale_x_discrete(expand = c(1, 0)) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
scale_x_discrete(expand = c(0, 0)) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
scale_x_discrete(expand = c(0, 0.2)) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
scale_x_discrete(expand = c(0.4, 0.2)) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
scale_x_discrete(expand = c(0.2, 0.4)) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
scale_x_discrete(expand = c(0.2, 3)) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = 0.8, position = position_dodge(width = 0.9)) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = 0.8) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = 1) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .7) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5, width = 2)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity") +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5, width = 20)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .8) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.5)
library(ggplot2)
library(vegan)
library(plyr)
library(dplyr)
library(scales)
library(grid)
library(reshape2)
library(phyloseq)
library(microbiome)
library(pairwiseAdonis)
####Loading in####
#Plotting theme
theme_set(theme_bw())
sharedfile = "UK.final.opti_mcc.0.03.subsample.shared"
taxfile = "UK.final.opti_mcc.0.03.cons.taxonomy"
mapfile = "MetadataUK.csv"
mothur_data <- import_mothur(mothur_shared_file = sharedfile,
mothur_constaxonomy_file = taxfile)
# Import sample metadata
map <- read.csv(mapfile)
#map = subset(map, Year == "3" | Year == "4")
map$Year <- as.factor(map$Year)
map <- sample_data(map)
# Assign rownames to be Sample ID's
rownames(map) <- map$group
moth_merge <- merge_phyloseq(mothur_data, map)
colnames(tax_table(moth_merge)) <- c("Kingdom", "Phylum", "Class",
"Order", "Family", "Genus")
Clean <- moth_merge %>%
subset_taxa(
Kingdom == "Bacteria" &
Family  != "mitochondria" &
Class   != "Chloroplast"
)
Clean_phylum <- Clean %>%
tax_glom(taxrank = "Phylum") %>%                     # agglomerate at phylum level
transform_sample_counts(function(x) {x/sum(x)} ) %>% # Transform to rel. abundance
psmelt() %>%                                         # Melt to long format
filter(Abundance > 0.01) %>%                         # Filter out low abundance taxa
arrange(Phylum)                                      # Sort data frame alphabetically by phylum
# Plot
phylum_colors <- c(
"#CBD588", "#5F7FC7", "orange","#DA5724", "#508578", "#CD9BCD",
"#AD6F3B", "#673770","#D14285", "#652926", "#C84248",
"#8569D5", "#5E738F","#D1A33D", "#8A7C64", "#599861"
)
Yearcomp = subset(Clean_phylum, Year == 1 | Year == 4)
ggplot(Yearcomp, aes(x = reorder(Sample,Cashcrop), y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.45)
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.45)
ggplot(Yearcomp, aes(x = Cashcrop, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.45)
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.45)
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_grid(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.45)
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_grid(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.45)
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
geom_vline(xintercept = 30.45)
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot") +
#geom_vline(xintercept = 30.45)
####Genus Graph####
Clean_genus <- Clean %>%
tax_glom(taxrank = "Genus") %>%                     # agglomerate at genus level
transform_sample_counts(function(x) {x/sum(x)} ) %>% # Transform to rel. abundance
psmelt() %>%                                         # Melt to long format
filter(Abundance > 0.02) %>%                         # Filter out low abundance taxa
filter(!grepl("unclassified", Genus)) %>%
arrange(Genus)                                      # Sort data frame alphabetically by genera
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot")
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum))
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum)) +
geom_bar(stat = "identity", width = .85)
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum)) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year)
ggplot(Yearcomp, aes(x = Sample, y = Abundance, fill = Phylum)) +
geom_bar(stat = "identity", width = .85) +
facet_grid(~Year)
View(Clean_phylum)
View(Yearcomp)
ggplot(Yearcomp, aes(x = group, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n Bacterial Communities by Plot")
sharedfile = "UK.final.opti_mcc.0.03.subsample.shared"
taxfile = "UK.final.opti_mcc.0.03.cons.taxonomy"
mapfile = "MetadataUK.csv"
mothur_data <- import_mothur(mothur_shared_file = sharedfile,
mothur_constaxonomy_file = taxfile)
# Import sample metadata
map <- read.csv(mapfile)
#map = subset(map, Year == "3" | Year == "4")
map$Year <- as.factor(map$Year)
map <- sample_data(map)
# Assign rownames to be Sample ID's
rownames(map) <- map$group
moth_merge <- merge_phyloseq(mothur_data, map)
colnames(tax_table(moth_merge)) <- c("Kingdom", "Phylum", "Class",
"Order", "Family", "Genus")
Clean <- moth_merge %>%
subset_taxa(
Kingdom == "Bacteria" &
Family  != "mitochondria" &
Class   != "Chloroplast"
)
Clean_phylum <- Clean %>%
tax_glom(taxrank = "Phylum") %>%                     # agglomerate at phylum level
transform_sample_counts(function(x) {x/sum(x)} ) %>% # Transform to rel. abundance
psmelt() %>%                                         # Melt to long format
filter(Abundance > 0.01) %>%                         # Filter out low abundance taxa
arrange(Phylum)                                      # Sort data frame alphabetically by phylum
# Plot
phylum_colors <- c(
"#CBD588", "#5F7FC7", "orange","#DA5724", "#508578", "#CD9BCD",
"#AD6F3B", "#673770","#D14285", "#652926", "#C84248",
"#8569D5", "#5E738F","#D1A33D", "#8A7C64", "#599861"
)
Yearcomp = subset(Clean_phylum, Year == 1 | Year == 4)
ggplot(Yearcomp, aes(x = plot, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n UK Bacterial Communities by Plot")
#map = subset(map, Year == "3" | Year == "4")
map$Year <- as.factor(map$Year)
map$plot <- as.factor(map$plot)
map <- sample_data(map)
# Assign rownames to be Sample ID's
rownames(map) <- map$group
moth_merge <- merge_phyloseq(mothur_data, map)
colnames(tax_table(moth_merge)) <- c("Kingdom", "Phylum", "Class",
"Order", "Family", "Genus")
Clean <- moth_merge %>%
subset_taxa(
Kingdom == "Bacteria" &
Family  != "mitochondria" &
Class   != "Chloroplast"
)
Clean_phylum <- Clean %>%
tax_glom(taxrank = "Phylum") %>%                     # agglomerate at phylum level
transform_sample_counts(function(x) {x/sum(x)} ) %>% # Transform to rel. abundance
psmelt() %>%                                         # Melt to long format
filter(Abundance > 0.01) %>%                         # Filter out low abundance taxa
arrange(Phylum)                                      # Sort data frame alphabetically by phylum
# Plot
phylum_colors <- c(
"#CBD588", "#5F7FC7", "orange","#DA5724", "#508578", "#CD9BCD",
"#AD6F3B", "#673770","#D14285", "#652926", "#C84248",
"#8569D5", "#5E738F","#D1A33D", "#8A7C64", "#599861"
)
Yearcomp = subset(Clean_phylum, Year == 1 | Year == 4)
ggplot(Yearcomp, aes(x = plot, y = Abundance, fill = Phylum)) +
#facet_grid(Station~.) +
geom_bar(stat = "identity", width = .85) +
facet_wrap(~Year) +
scale_fill_manual(values = phylum_colors) +
theme(axis.title.x = element_blank(), axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
#
guides(fill = guide_legend(reverse = TRUE, keywidth = 1, keyheight = 1)) +
ylab("Relative Abundance (Phyla > 1%) \n") +
ggtitle("Phylum Composition of Spring 2024 \n UK Bacterial Communities by Plot")
